# Sistema ENEDES - PHP/Apache

Sistema completo de gestÃ£o de projetos ENEDES desenvolvido em PHP com Apache, compatÃ­vel com Render.com e PostgreSQL.

## ğŸš€ Funcionalidades Principais

- **Dashboard Executivo**: VisÃ£o geral com mÃ©tricas, estatÃ­sticas e grÃ¡ficos interativos
- **GestÃ£o de Metas**: Cadastro e acompanhamento de metas estratÃ©gicas com indicadores
- **Cronograma Financeiro**: Controle de etapas, prazos e execuÃ§Ã£o orÃ§amentÃ¡ria
- **Programas**: GestÃ£o completa de 8 programas com aÃ§Ãµes e inventÃ¡rio
- **Follow-ups Inteligentes**: Sistema de acompanhamento com tarefas e colaboradores
- **Sistema de Tarefas**: CriaÃ§Ã£o, gerenciamento e anexos de arquivos
- **InventÃ¡rio de Equipamentos**: Controle de recursos por programa com valores
- **Controle de Acesso**: Perfis diferenciados (Coordenador Geral e Coordenadores de Programa)
- **Sistema HÃ­brido**: Funciona online (backend) e offline (localStorage) automaticamente
- **Farol de Acompanhamento**: Indicadores visuais de status por programa

## ğŸ› ï¸ Tecnologias e Arquitetura

- **Frontend**: HTML5, CSS3, JavaScript ES6+, Tailwind CSS
- **Backend**: PHP 8.1 com Apache
- **Banco de Dados**: PostgreSQL (Render Database)
- **Deploy**: Render.com com Docker (auto-deploy do GitHub)
- **ContainerizaÃ§Ã£o**: Docker com php:8.1-apache + PostgreSQL extensions
- **Sistema HÃ­brido**: Backend + LocalStorage fallback automÃ¡tico
- **APIs**: RESTful com CORS configurado
- **Compatibilidade**: Fallbacks para Ã­cones (emoji) e grÃ¡ficos (CSS) quando scripts externos falham

## ğŸ“‹ Estrutura Real do Projeto

```
SISTEM/ (Raiz do Projeto)
â”œâ”€â”€ index.html              # Frontend principal (166KB - sistema hÃ­brido)
â”œâ”€â”€ api.php                 # Backend API PHP (26KB - na raiz)
â”œâ”€â”€ Dockerfile              # ConfiguraÃ§Ã£o Docker para deploy
â”œâ”€â”€ render.yaml             # ConfiguraÃ§Ã£o automÃ¡tica do Render
â”œâ”€â”€ .env.example            # Exemplo de variÃ¡veis de ambiente
â”œâ”€â”€ .gitignore              # Arquivos ignorados pelo Git
â”œâ”€â”€ README.md               # DocumentaÃ§Ã£o do projeto (7KB)
â””â”€â”€ ESTRUTURA_PROJETO.txt   # Este arquivo de estrutura
```

### ğŸ“ Detalhes dos Arquivos

| Arquivo | Tamanho | DescriÃ§Ã£o |
|---------|---------|-----------|
| `index.html` | 166KB | Frontend completo com sistema hÃ­brido online/offline |
| `api.php` | 26KB | Backend API REST com PostgreSQL e CORS |
| `Dockerfile` | 435B | ConfiguraÃ§Ã£o Docker simples e otimizada |
| `render.yaml` | 330B | Deploy automÃ¡tico com banco PostgreSQL |
| `README.md` | 7KB | DocumentaÃ§Ã£o completa do projeto |
| `.env.example` | 381B | Template de variÃ¡veis de ambiente |
| `.gitignore` | 505B | ExclusÃµes do controle de versÃ£o |

## ğŸ“¦ ConfiguraÃ§Ã£o do Docker

### Dockerfile (Real)
```dockerfile
FROM php:8.1-apache
# Instalar extensÃµes PHP necessÃ¡rias
RUN docker-php-ext-install pdo pdo_pgsql
# Habilitar mod_rewrite do Apache
RUN a2enmod rewrite
# Copiar todos os arquivos para o diretÃ³rio web do Apache
COPY . /var/www/html/
```

**CaracterÃ­sticas:**
- âœ… **Base**: PHP 8.1 com Apache integrado
- âœ… **PostgreSQL**: ExtensÃµes `pdo` e `pdo_pgsql` instaladas
- âœ… **Mod Rewrite**: Habilitado para URLs amigÃ¡veis
- âœ… **CÃ³pia Simples**: Todos arquivos copiados para `/var/www/html/`

## ğŸŒ Deploy no Render - ConfiguraÃ§Ã£o Real

### render.yaml (ConfiguraÃ§Ã£o Atual)
```yaml
services:
  - type: web
    name: enedessystem
    env: docker
    plan: free
    dockerfilePath: ./Dockerfile
    envVars:
      - key: DATABASE_URL
        fromDatabase:
          name: enedes-db
          property: connectionString

databases:
  - name: enedes-db
    databaseName: enedes
    user: enedes_user
    plan: free
```

### ğŸ“Š **STATUS ATUAL**
- **URL do Sistema**: `https://enedessystem.onrender.com`
- **ServiÃ§o**: `enedessystem` (nome real do render.yaml)
- **Banco**: PostgreSQL automÃ¡tico do Render (nÃ£o Neon)
- **Database**: `enedes-db` com usuÃ¡rio `enedes_user`
- **Environment**: `DATABASE_URL` configurada automaticamente

### âœ… **Vantagens da ConfiguraÃ§Ã£o Atual**
1. **Deploy AutomÃ¡tico**: Render gerencia banco automaticamente
2. **Zero ConfiguraÃ§Ã£o**: DATABASE_URL gerada automaticamente
3. **Backup IncluÃ­do**: Render faz backup do PostgreSQL
4. **SSL AutomÃ¡tico**: HTTPS configurado automaticamente
5. **Monitoramento**: Logs e mÃ©tricas integrados

## ğŸ“± API Endpoints - Estrutura Real

**Base URL**: `https://enedessystem.onrender.com/api.php`

### ğŸ”§ Sistema e Teste
- `GET /api.php?endpoint=test` - Teste completo da API e conexÃ£o
- `GET /api.php?endpoint=health` - Status de saÃºde do sistema

### ğŸ¯ Metas/Goals
- `GET /api.php?endpoint=goals` - Listar todas as metas
- `POST /api.php?endpoint=goals` - Criar nova meta
- `PUT /api.php?endpoint=goals&id={id}` - Atualizar meta especÃ­fica
- `DELETE /api.php?endpoint=goals&id={id}` - Excluir meta

### âš¡ AÃ§Ãµes
- `GET /api.php?endpoint=actions` - Listar todas as aÃ§Ãµes
- `GET /api.php?endpoint=actions&goal_id={id}` - AÃ§Ãµes de uma meta especÃ­fica
- `POST /api.php?endpoint=actions` - Criar nova aÃ§Ã£o
- `PUT /api.php?endpoint=actions&id={id}` - Atualizar aÃ§Ã£o
- `DELETE /api.php?endpoint=actions&id={id}` - Excluir aÃ§Ã£o

### ğŸ“… Sistema de Follow-ups (HÃ­brido)
- **Online**: API + PostgreSQL
- **Offline**: LocalStorage automÃ¡tico
- **SincronizaÃ§Ã£o**: DetecÃ§Ã£o automÃ¡tica de conectividade

### ğŸ“Š Formato de Resposta
```json
{
  "status": "success",
  "data": [...],
  "timestamp": "2025-07-19 13:05:08",
  "database_connected": true,
  "config_method": "Render Database (Auto)"
}
```

## ğŸ”§ Desenvolvimento Local

### Usando Docker (ConfiguraÃ§Ã£o Real)

```bash
# Clone o repositÃ³rio
git clone https://github.com/EnedesIF/SISTEM
cd SISTEM

# Build usando o Dockerfile real
docker build -t enedes-system .

# Execute localmente (sem banco para desenvolvimento)
docker run -p 8080:80 enedes-system

# Execute com banco PostgreSQL local (opcional)
docker run -p 8080:80 \
  -e DATABASE_URL="postgresql://user:pass@localhost:5432/enedes" \
  enedes-system

# Acesse o sistema
# Frontend: http://localhost:8080
# API Test: http://localhost:8080/api.php?endpoint=test
```

### Desenvolvimento Offline

O sistema funciona **100% offline** por padrÃ£o:
- Todos os dados salvos em `localStorage`
- GrÃ¡ficos e Ã­cones com fallbacks
- Zero dependÃªncias externas obrigatÃ³rias

## ğŸš€ URLs de Teste - ConfiguraÃ§Ã£o Real

### ğŸŒ Sistema Principal
- **Frontend**: `https://enedessystem.onrender.com/`
- **Login**: Qualquer usuÃ¡rio com senha `123456`

### ğŸ”§ Testes de API
- **Teste Completo**: `https://enedessystem.onrender.com/api.php?endpoint=test`
- **Metas Backend**: `https://enedessystem.onrender.com/api.php?endpoint=goals`
- **AÃ§Ãµes Backend**: `https://enedessystem.onrender.com/api.php?endpoint=actions`

### âœ… Resposta de Sucesso Esperada
```json
{
  "status": "success",
  "message": "ENEDES API funcionando perfeitamente!",
  "timestamp": "2025-07-19 13:05:08",
  "method": "GET",
  "php_version": "8.1.33",
  "database_connected": true,
  "config_method": "Render Database (Auto)",
  "environment": "Production"
}
```

## ğŸ‘¥ UsuÃ¡rios PadrÃ£o do Sistema

| UsuÃ¡rio | Senha | Perfil | Programa |
|---------|-------|--------|----------|
| CoordenaÃ§Ã£o Geral | 123456 | Coordenador Geral | Todos |
| IFB Mais Empreendedor | 123456 | Coordenador de Programa | IFB Mais Empreendedor |
| Rota Empreendedora | 123456 | Coordenador de Programa | Rota Empreendedora |
| Lab Varejo | 123456 | Coordenador de Programa | Lab Varejo |
| Lab Consumer | 123456 | Coordenador de Programa | Lab Consumer |
| EstÃºdio | 123456 | Coordenador de Programa | EstÃºdio |
| IFB Digital | 123456 | Coordenador de Programa | IFB Digital |
| Sala Interativa | 123456 | Coordenador de Programa | Sala Interativa |
| AgÃªncia de Marketing | 123456 | Coordenador de Programa | AgÃªncia de Marketing |

## ğŸ› SoluÃ§Ã£o de Problemas EspecÃ­ficos

### âŒ Sistema nÃ£o Carrega
**VerificaÃ§Ãµes**:
1. URL correta: `https://enedessystem.onrender.com/`
2. Render service estÃ¡ ativo?
3. Docker build foi bem-sucedido?

### âŒ API Retorna 404
**Causas**:
- Arquivo `api.php` nÃ£o estÃ¡ na raiz
- Apache nÃ£o configurado corretamente

**SoluÃ§Ã£o**:
```bash
# Verificar estrutura
ls -la /var/www/html/
# Deve mostrar: api.php, index.html, etc.
```

### âŒ Banco de Dados nÃ£o Conecta
**VerificaÃ§Ãµes**:
1. DATABASE_URL estÃ¡ sendo injetada pelo Render?
2. PostgreSQL database `enedes-db` estÃ¡ ativo?
3. Render plan free ainda tem recursos?

**Teste Manual**:
```bash
# Verificar environment variables no container
env | grep DATABASE_URL
```

### âŒ Deploy Falha
**Causas Comuns**:
- Dockerfile com erro de sintaxe
- Arquivos muito grandes (> 100MB)
- Render plan limits excedidos

**SoluÃ§Ã£o**:
1. Check Render logs no dashboard
2. Verificar `.gitignore` estÃ¡ correto
3. Reduzir tamanho dos arquivos se necessÃ¡rio

## ğŸ“ˆ Status Atual e Roadmap (19/07/2025)

### âœ… **ConfiguraÃ§Ã£o Real Funcionando**
- âœ… **Estrutura Correta**: Arquivos na raiz como definido
- âœ… **Render YAML**: Deploy automÃ¡tico configurado
- âœ… **PostgreSQL**: Banco gerenciado pelo Render
- âœ… **Docker**: Build simples e eficiente
- âœ… **Frontend**: 166KB de cÃ³digo hÃ­brido
- âœ… **Backend**: 26KB de API PHP completa

### âš™ï¸ **Comandos de Deploy Manual**
```bash
# Se precisar redescarregar
git add .
git commit -m "Deploy atualizaÃ§Ã£o"
git push origin main

# Render farÃ¡ deploy automÃ¡tico
# Ou usar deploy manual no dashboard
```

### ğŸ“Š **Arquitetura Final**
```
GitHub (main) â†’ Render (auto-build) â†’ Docker â†’ Apache + PHP 8.1 â†’ PostgreSQL
     â†“              â†“                    â†“           â†“              â†“
 Desenvolver â†’ Push automatico â†’ Container â†’ index.html + api.php â†’ Dados
```

### ğŸ¯ **Sistema 100% Operacional**
- **URL**: `https://enedessystem.onrender.com/`
- **Status**: âœ… **FUNCIONANDO**
- **Backup**: Sistema hÃ­brido com localStorage
- **Monitoramento**: Logs do Render disponÃ­veis

---

**Sistema ENEDES PHP** - GestÃ£o Completa de Projetos v2.0  
**Estrutura Real Documentada**: 19/07/2025  
**Status**: âœ… **OPERACIONAL** âœ…
